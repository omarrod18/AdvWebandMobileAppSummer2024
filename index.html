<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.2.0/mustache.min.js"></script>
</head>
<body>
    <div id="view-toggle" style="text-align: center; margin: 20px;">
        <button id="grid-view-button">Grid View</button>
        <button id="list-view-button">List View</button>
    </div>
    <div id="search-results" class="row"></div>
    <template id="grid-template">
        {{#items}}
        <div class="col-md-4">
            <div class="book-item">
                <img src="{{thumbnail}}" alt="Book cover">
                <h5><a href="#" class="book-link" data-id="{{id}}">{{title}}</a></h5>
            </div>
        </div>
        {{/items}}
    </template>
    <template id="list-template">
        {{#items}}
        <div class="col-12">
            <div class="book-item">
                <img src="{{thumbnail}}" alt="Book cover" style="float:left; margin-right: 20px;">
                <h5><a href="#" class="book-link" data-id="{{id}}">{{title}}</a></h5>
            </div>
        </div>
        {{/items}}
    </template>
    <div id="book-details" class="book-details" style="display:none;"></div>
    <template id="book-details-template">
        <img id="book-cover" src="{{thumbnail}}" alt="Book cover">
        <h2>{{title}}</h2>
        <h4>{{authors}}</h4>
        <p>{{publisher}}</p>
        <p>{{publishedDate}}</p>
        <p>{{description}}</p>
        <p>{{pageCount}}</p>
        <p>{{categories}}</p>
        <p>{{averageRating}}</p>
        <p><a href="{{infoLink}}" target="_blank">More Info</a></p>
    </template>
    <div class="pagination"></div>
    
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" id="search-tab" data-toggle="tab" href="#search-results-tab">Search Results</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="bookshelf-tab" data-toggle="tab" href="#bookshelf-tab-content">Bookshelf</a>
        </li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane fade show active" id="search-results-tab">
            <div id="search-results" class="row"></div>
        </div>
        <div class="tab-pane fade" id="bookshelf-tab-content">
            <!-- Bookshelf content will be loaded here -->
        </div>
    </div>
    <script>
        const apiKey = 'AIzaSyDJBWE0Ji-2QCq6W1Agt8XwK7vKAukP4II';
        const gridTemplate = document.getElementById('grid-template').innerHTML;
        const listTemplate = document.getElementById('list-template').innerHTML;
        const bookDetailsTemplate = document.getElementById('book-details-template').innerHTML;
        let currentData = null;
        let currentPage = 1;
        const itemsPerPage = 10;
        let totalPages = 1;
        $(document).ready(function () {
            $('#search-button').click(function () {
                const query = $('#search-input').val();
                if (query) {
                    searchBooks(query);
                }
            });
            document.getElementById('grid-view-button').addEventListener('click', () => {
                renderBooks(currentData, 'grid');
            });
            document.getElementById('list-view-button').addEventListener('click', () => {
                renderBooks(currentData, 'list');
            });
            $('#bookshelf-tab').on('shown.bs.tab', function (e) {
                if (!$('#bookshelf-tab-content').html()) {
                    $('#bookshelf-tab-content').load('bookshelf.html');
                }
            });
        });
        function searchBooks(query) {
            $.getJSON(`https://www.googleapis.com/books/v1/volumes?q=${query}&key=${apiKey}&startIndex=${(currentPage-1) * itemsPerPage}&maxResults=${itemsPerPage}`, function (data) {
                currentData = data;
                totalPages = Math.ceil(data.totalItems / itemsPerPage);
                renderBooks(data, 'grid');
                updatePagination();
            }).fail(function () {
                $('#search-results').html('<p>An error occurred while searching for the book.</p>');
            });
        }
        function renderBooks(data, view = 'grid') {
            const template = view === 'grid' ? gridTemplate : listTemplate;
            const rendered = Mustache.render(template, { items: data.items.map(item => ({
                id: item.id,
                title: item.volumeInfo.title,
                thumbnail: item.volumeInfo.imageLinks ? item.volumeInfo.imageLinks.thumbnail : 'https://via.placeholder.com/150x200?text=No+Image'
            })) });
            document.getElementById('search-results').innerHTML = rendered;
            document.querySelectorAll('.book-link').forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();
                    displayBookDetails(this.dataset.id);
                });
            });
        }
        function displayBookDetails(bookId) {
            $.getJSON(`https://www.googleapis.com/books/v1/volumes/${bookId}?key=${apiKey}`, function (data) {
                const book = data.volumeInfo;
                const rendered = Mustache.render(bookDetailsTemplate, {
                    thumbnail: book.imageLinks ? book.imageLinks.thumbnail : 'https://via.placeholder.com/200x300?text=No+Image',
                    title: book.title || 'No Title',
                    authors: 'Authors: ' + (book.authors ? book.authors.join(", ") : 'N/A'),
                    publisher: 'Publisher: ' + (book.publisher || 'N/A'),
                    publishedDate: 'Published Date: ' + (book.publishedDate || 'N/A'),
                    description: 'Description: ' + (book.description || 'N/A'),
                    pageCount: 'Page Count: ' + (book.pageCount || 'N/A'),
                    categories: 'Categories: ' + (book.categories ? book.categories.join(", ") : 'N/A'),
                    averageRating: 'Average Rating: ' + (book.averageRating || 'N/A'),
                    infoLink: book.infoLink
                });
                $('#book-details').html(rendered).show();
            }).fail(function () {
                $('#book-details').html('<p>An error occurred while fetching the book details.</p>');
            });
        }
        function updatePagination() {
            $('.pagination').empty();
            if (totalPages > 1) {
                for (let i = 1; i <= totalPages; i++) {
                    const pageButton = `<button class="${i === currentPage ? 'active' : ''}" onclick="gotoPage(${i})">${i}</button>`;
                    $('.pagination').append(pageButton);
                }
            }
        }
        function gotoPage(page) {
            currentPage = page;
            searchBooks($('#search-input').val());
        }
    </script>
</body>






